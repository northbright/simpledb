# simpledb

[![Build Status](https://travis-ci.org/northbright/simpledb.svg?branch=master)](https://travis-ci.org/northbright/simpledb)
[![Go Report Card](https://goreportcard.com/badge/github.com/northbright/simpledb)](https://goreportcard.com/report/github.com/northbright/simpledb)

simpledb is a [Golang](https://golang.org) package which provides CRUD and search operations on records stored in Redis. It's based on [Redigo](https://github.com/garyburd/redigo).

#### How it works
* Record Buckets
    * simpledb stores a record in a Redis hash(we call it record bucket).
    * Hash key name: contains record bucket id generated by record id.
        * record bucket id = record id / hash-max-ziplist-entries. Ex: "student/bucket/23".
    * Hash field: record id.
    * Value of field: record data.
    * The number of hash entries is the same as "hash-max-ziplist-entries" of Redis settings to reduce memory usage.
        * User should also make sure record data length matches "hash-max-ziplist-values".

* Index Buckets
    * simple db stores one more record data as reverse index in a Redis hash(we call it index bucket).
    * Hash key name: contains index bucket id generated by record data.
        * index bucket id = CRC32(record data) % Estimated Bucket Num. Ex: "student/idx/bucket/3".
        * Estimated Bucket Num = Estimated Max Record Num(1000000 by default) / ("hash-max-ziplist-entries" * 0.9").
    * Hash field: record data(duplicated).
    * Value of field: record id.

* Search
    * Search() scans all index buckets(hashes) and use HSCAN command with pattern of Redis(Ex: `'{"name":"Frank*"}*'`) on record data directly to find matched record ids.
    * RegexpSeach() scans all index buckets(hashes) and use HSCAN command to retrieve all fields and use Regexp pattern(Ex: `'{"name":"Frank.+"}'`) on record data directly to find matched record ids.

#### Documentation
* [API Reference](https://godoc.org/github.com/northbright/simpledb)

#### License
* [MIT License](./LICENSE)
